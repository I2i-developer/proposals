<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic SWP Proposal Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #f1f5f9; 
            -webkit-print-color-adjust: exact; 
            print-color-adjust: exact;
        }

        .gradient-bg { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); }
        .card { background: white; border-radius: 1.5rem; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05); }
        .stat-card { border-left: 4px solid #3b82f6; }

        /* Input styling */
        .input-field {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            outline: none;
            transition: all 0.2s;
        }
        .input-field:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }

        @media print {
            .print-center-page {
                break-before: page;
                height: 100vh; /* Full page height */
                display: flex !important;
                flex-direction: column !important;
                justify-content: center !important; /* Vertical center */
                align-items: center !important;     /* Horizontal center */
                margin: 0 !important;
            }
            #wealthChart, .print\:h-60 {
                height: 300px !important;
            }
            .print-center-page .card {
                width: 80% !important; /* Make card wider on the page */
                box-shadow: none !important;
                border: 1px solid #e2e8f0 !important;
            }
            @page { size: A4; margin: 1cm; }
            body { background-color: white !important; padding: 0 !important; margin: 0 !important; }
            .no-print { display: none !important; }
            .gradient-bg { background: #1e293b !important; color: white !important; border-radius: 1.5rem !important; }
            .card { box-shadow: none !important; }
            tr { page-break-inside: avoid; }
            .sticky { position: static !important; }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        
        <!-- Input Section (Hidden on Print) -->
        <div class="no-print bg-white p-6 rounded-3xl shadow-lg mb-8 border border-blue-100">
            <div class="flex items-center gap-4 mb-4 border-b border-slate-200 pb-3">
                <button onclick="window.location.href='index.html'" class="text-slate-400 hover:text-blue-600 transition-colors">
                    <i class="fa fa-home fa-sm mr-1"></i> Dashboard
                </button>
                <div class="h-4 w-[1px] bg-slate-300"></div>
                <h1 class="font-bold text-slate-700 uppercase text-xs tracking-widest">Systematic Withdrawal Plan Proposal / <span class="text-blue-600">Draft #Ideas2invest</span></h1>
            </div>
            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                Proposal Customizer
            </h2>
            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wide">Client Name</label>
                        <input type="text" id="inputClientName" value="Monica Ghambhir" class="input-field w-full">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wide">Investment (₹)</label>
                        <input type="number" id="inputInvestment" value="40800000" class="input-field w-full">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wide">Annual SWP (%)</label>
                        <input type="number" id="inputSWP" value="8" step="0.1" class="input-field w-full">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wide">Exp. Return (%)</label>
                        <input type="number" id="inputReturn" value="12" step="0.5" class="input-field w-full">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wide">Tenure (Years)</label>
                        <input type="number" id="inputTenure" value="25" min="1" max="50" class="input-field w-full">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wide">Step-up Rate (%) ('0' for no step-up)</label>
                        <input type="number" id="inputStepUpRate" value="5" min="0" max="25" class="input-field w-full">
                    </div>
                    <div id="stepUpIntervalGroup">
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wide">Step-up Interval</label>
                        <select id="inputStepUpInterval" class="input-field w-full">
                            <option value="1">Every Year</option>
                            <option value="2">Every 2 Years</option>
                            <option value="3" selected>Every 3 Years</option>
                            <option value="5">Every 5 Years</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wide">Fund Names (Separated by comma)</label>
                        <input type="text" id="inputFundName" placeholder="e.g. HDFC Balanced Advantage Fund" class="input-field w-full">
                    </div>
                </div>
            </div>
            <div class="mt-6 flex gap-3">
                <button onclick="updateProposal()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-xl font-bold transition flex-1 shadow-md">
                    Update Proposal
                </button>
                <button onclick="window.print()" class="bg-gray-800 hover:bg-black text-white px-6 py-2.5 rounded-xl font-bold transition flex items-center gap-2 shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
                    Print PDF
                </button>
            </div>
        </div>

        <!-- Start of Proposal Area -->
        <div id="proposalContent">
            <!-- Header -->
            <!-- <header class="gradient-bg text-white p-8 md:p-12 rounded-[2.5rem] mb-10 shadow-2xl relative overflow-hidden">
                <div class="relative z-10 flex flex-row md:flex-row justify-between items-start">
                    <div class="max-w-2xl">
                        <span class="bg-blue-500/20 text-blue-300 px-4 py-1 rounded-full text-sm font-semibold tracking-widest uppercase">Strategic Wealth Proposal</span>
                        <h1 class="text-4xl md:text-5xl font-bold mt-4 leading-tight">Harvesting Growth.<br><span class="text-blue-400">Securing Legacy.</span></h1>
                    </div>
                    <div class="mt-6 md:mt-0 flex flex-col items-center md:items-end">
                        <div class="bg-white p-4 rounded-2xl border border-gray-200">
                            <div class="w-36 h-22 flex items-center justify-center rounded-lg overflow-hidden">
                                <img
                                    src="https://www.ideas2invest.com/assets/images/logo/logo.png"
                                    alt="Company Logo"
                                    class="max-w-full max-h-full object-contain"
                                />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="relative z-10 mt-8 flex flex-row md:flex-row md:items-center gap-6 border-t border-white/10 pt-8">
                    <div>
                        <p class="text-white/60 text-xs uppercase tracking-wider">Client Name</p>
                        <p id="displayClientName" class="text-xl font-semibold">Monica Ghambhir</p>
                    </div>
                    <div class="hidden md:block w-px h-10 bg-white/10"></div>
                    <div>
                        <p class="text-white/60 text-xs uppercase tracking-wider">Initial Investment</p>
                        <p id="displayInvestment" class="text-xl font-semibold text-blue-300"></p>
                    </div>
                    <div class="hidden md:block w-px h-10 bg-white/10"></div>
                    <div>
                        <p class="text-white/60 text-xs uppercase tracking-wider">Strategy</p>
                        <p class="text-xl font-semibold">Systematic Withdrawal Plan</p>
                    </div>
                </div>
                <div class="absolute -right-20 -bottom-20 w-80 h-80 bg-blue-500/10 rounded-full blur-3xl"></div>
            </header> -->
            <header class="bg-white border border-gray-500 p-8 md:p-8 rounded-[2.5rem] mb-10 shadow-lg relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-gray-50/50 to-white pointer-events-none"></div>
                
                <div class="relative z-10 flex flex-row justify-between items-start">
                    <div class="max-w-2xl">
                        <span class="bg-gray-100 text-gray-600 px-4 py-1 rounded-full text-xs font-bold tracking-widest uppercase border border-gray-200">
                            Strategic Wealth Proposal
                        </span>
                        <h1 class="text-4xl md:text-5xl font-extrabold mt-6 leading-tight text-gray-900">
                            Harvesting Growth.<br>
                            <span class="text-blue-600">
                                Securing Legacy.
                            </span>
                        </h1>
                    </div>
                    
                    <div class="mt-6 md:mt-0 flex flex-col items-center md:items-end">
                        <div class="bg-white p-4 rounded-2xl border border-gray-100 shadow-md">
                            <div class="w-36 h-22 flex items-center justify-center rounded-lg overflow-hidden">
                                <img
                                    src="https://www.ideas2invest.com/assets/images/logo/logo.png"
                                    alt="Company Logo"
                                    class="max-w-full max-h-full object-contain"
                                />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="relative z-10 mt-10 flex flex-wrap md:flex-row md:items-center gap-8 border-t border-gray-100 pt-8">
                    <div class="group">
                        <p class="text-indigo-500/80 text-[11px] font-bold uppercase tracking-widest bg-indigo-50 w-fit px-2 py-0.5 rounded mb-1">Valuable Client</p>
                        <p id="displayClientName" class="text-lg font-bold transition-colors text-indigo-600">Monica Ghambhir</p>
                    </div>
                    
                    <div class="hidden md:block w-0.5 h-10 bg-gray-400"></div>
                    
                    <div class="group">
                        <p class="text-emerald-600/80 text-[11px] font-bold uppercase tracking-widest bg-emerald-50 w-fit px-2 py-0.5 rounded mb-1">Initial Investment</p>
                        <p id="displayInvestment" class="text-lg font-bold transition-colors text-emerald-600">₹4,08,00,000</p>
                    </div>
                    
                    <div class="hidden md:block w-0.5 h-10 bg-gray-500"></div>
                    
                    <div class="group">
                        <p class="text-amber-600/80 text-[11px] font-bold uppercase tracking-widest bg-amber-50 w-fit px-2 py-0.5 rounded mb-1">Strategy</p>
                        <p class="text-lg font-bold transition-colors text-amber-600">Systematic Withdrawal Plan</p>
                    </div>
                </div>
            </header>

            <!-- Stats Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="card p-5 stat-card">
                    <p class="text-gray-500 text-sm font-bold uppercase">Initial Monthly SWP</p>
                    <p id="monthlyPayoutLabel" class="text-xl font-bold text-gray-900 mt-1"></p>
                    <p id="swpRateLabel" class="text-[13px] text-blue-600 mt-1 font-bold"></p>
                </div>
                <div class="card p-5 stat-card border-l-green-500">
                    <p class="text-gray-500 text-sm font-bold uppercase">Expected Return</p>
                    <p id="returnRateLabel" class="text-xl font-bold text-green-600 mt-1"></p>
                    <p class="text-[13px] font-semibold text-gray-500 mt-1 italic">Compounded Growth</p>
                </div>
                <div class="card p-5 stat-card border-l-purple-500">
                    <p class="text-gray-500 text-sm font-bold uppercase">Time Horizon</p>
                    <p id="horizonLabel" class="text-xl font-bold text-gray-900 mt-1"></p>
                    <p class="text-[13px] font-semibold text-gray-500 mt-1 italic">Long Term Strategy</p>
                </div>
                <div class="card p-5 stat-card border-l-orange-500">
                    <p class="text-gray-500 text-sm font-bold uppercase">Total Income</p>
                    <p id="totalIncomeLabel" class="text-xl font-bold text-gray-900 mt-1"></p>
                    <p id="totalIncomeSubtitle" class="text-[13px] font-semibold text-gray-500 mt-1 italic"></p>
                </div>
                <!-- <div class="card p-5 stat-card border-l-blue-500 col-span-2 md:col-span-4">
                    <p class="text-gray-500 text-sm font-bold uppercase">Selected Fund</p>
                    <p id="fundNameLabel" class="text-xl font-bold text-gray-900 mt-1">HDFC Balanced Advantage Fund</p>
                    <p class="text-[13px] font-semibold text-gray-500 mt-1 italic">Primary Investment Vehicle</p>
                </div> -->
                <div class="card p-5 stat-card border-l-emerald-500 col-span-2 md:col-span-4">
                    <p class="text-gray-500 text-sm font-bold uppercase mb-2">Selected Funds</p>
                    <div id="fundNameContainer" class="flex flex-wrap gap-2">
                        <span class="text-gray-400 italic text-sm">No funds entered</span>
                    </div>
                </div>
            </div>

            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Roadmap Table -->
                <div class="w-full lg:w-2/3 card">
                    <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                        <h2 id="tableHeading" class="text-lg font-bold text-gray-800 uppercase tracking-tight"></h2>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-sm font-bold text-gray-500 border-b uppercase">Year</th>
                                    <th class="p-3 text-sm font-bold text-gray-500 border-b text-right uppercase">Opening Bal</th>
                                    <th class="p-3 text-sm font-bold text-gray-500 border-b text-right uppercase">Withdrawal</th>
                                    <th class="p-3 text-sm font-bold text-gray-500 border-b text-right uppercase">Closing Bal</th>
                                </tr>
                            </thead>
                            <tbody id="projectionBody" class="divide-y divide-gray-50"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Right Side Summary -->
                <div class="w-full lg:w-1/3 space-y-6 print:mt-0">
                    <div class="card p-6 sticky top-4 print:static print:shadow-none print:border">
                        <h3 class="text-md font-bold mb-4 text-gray-800 uppercase text-center border-b pb-4">Wealth Summary</h3>
                        
                        <div class="h-80 mb-6 print:h-60">
                            <canvas id="wealthChart"></canvas>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="p-4 bg-blue-50 rounded-xl print:bg-gray-50 print:border">
                                <p class="text-xs text-blue-600 font-bold uppercase mb-1">Total Payout Received</p>
                                <p id="summaryIncomeLabel" class="text-xl font-bold text-blue-900"></p>
                            </div>
                            <div class="p-4 bg-green-50 rounded-xl print:bg-gray-50 print:border">
                                <p class="text-xs text-green-600 font-bold uppercase mb-1">Final Asset Value</p>
                                <p id="finalValueLabel" class="text-xl font-bold text-green-900"></p>
                            </div>
                        </div>

                        <div class="mt-6 border-t pt-6">
                            <h4 class="text-base font-bold text-gray-700 mb-2">Portfolio Insights:</h4>
                            <p id="insightText" class="text-base text-gray-600 leading-relaxed"></p>
                        </div>
                    </div>
                </div>

            </div>

            <footer class="mt-8 text-center text-gray-500 text-[13px] mb-12 pb-2 border-t pt-8">
                <p>© Prepared for <span id="footerClientName">Monica Ghambhir</span> | Confidential Investment Proposal</p>
                <p class="mt-1 uppercase tracking-widest font-semibold">Ideas2Invest</p>
            </footer>
        </div>
    </div>

    <script>
        let wealthChart = null;

        const formatCurrency = (val) => new Intl.NumberFormat('en-IN', {
            maximumFractionDigits: 0
        }).format(val);

        function updateProposal() {
            // Get values from inputs
            const clientName = document.getElementById('inputClientName').value;
            const investment = parseFloat(document.getElementById('inputInvestment').value) || 0;
            const withdrawalPercent = (parseFloat(document.getElementById('inputSWP').value) || 0) / 100;
            const returnPercent = (parseFloat(document.getElementById('inputReturn').value) || 0) / 100;
            const years = parseInt(document.getElementById('inputTenure').value) || 1;
            const stepUpRate = (parseFloat(document.getElementById('inputStepUpRate').value) || 0) / 100;
            const stepUpInterval = parseInt(document.getElementById('inputStepUpInterval').value) || 1;

            // Step up visibility
            const intervalGroup = document.getElementById('stepUpIntervalGroup');
            intervalGroup.style.display = stepUpRate > 0 ? 'block' : 'none';

            // Update UI Labels
            document.getElementById('displayClientName').innerText = clientName;
            document.getElementById('footerClientName').innerText = clientName;
            document.getElementById('displayInvestment').innerText = `₹ ${formatCurrency(investment)}`;
            document.getElementById('horizonLabel').innerText = `${years} Years`;
            document.getElementById('totalIncomeSubtitle').innerText = `Over ${years} Years`;
            document.getElementById('tableHeading').innerText = `Financial Roadmap (${years} Years)`;
            
            let initialMonthly = (investment * withdrawalPercent) / 12;
            document.getElementById('monthlyPayoutLabel').innerText = `₹ ${formatCurrency(initialMonthly)}`;
            
            let swpStatus = stepUpRate > 0 ? `${(withdrawalPercent * 100).toFixed(1)}% + ${(stepUpRate * 100).toFixed(0)}% Step-up` : `${(withdrawalPercent * 100).toFixed(1)}% Annual Fixed`;
            document.getElementById('swpRateLabel').innerText = swpStatus;
            document.getElementById('returnRateLabel').innerText = `${(returnPercent * 100).toFixed(0)}% p.a.`;

            // Roadmap Logic
            let currentBalance = investment;
            let currentYearlyWithdrawal = investment * withdrawalPercent;
            const tableBody = document.getElementById('projectionBody');
            tableBody.innerHTML = '';
            let totalIncome = 0;

            for (let i = 1; i <= years; i++) {
                // Apply step-up if interval met
                if (i > 1 && (i - 1) % stepUpInterval === 0 && stepUpRate > 0) {
                    currentYearlyWithdrawal *= (1 + stepUpRate);
                }

                const opening = currentBalance;
                const afterWithdrawal = opening - currentYearlyWithdrawal;
                
                if (afterWithdrawal < 0) {
                   tableBody.innerHTML += `<tr><td colspan="4" class="p-6 text-center text-red-500 font-bold uppercase italic">Portfolio depleted in Year ${i}</td></tr>`;
                   break;
                }

                const growth = afterWithdrawal * returnPercent;
                const closing = afterWithdrawal + growth;
                totalIncome += currentYearlyWithdrawal;
                
                tableBody.innerHTML += `
                    <tr class="hover:bg-gray-100 transition-colors">
                        <td class="p-3 text-[15px] font-semibold text-gray-500">Year ${i}</td>
                        <td class="p-3 text-[15px] font-semibold text-right text-gray-700">₹ ${formatCurrency(opening)}</td>
                        <td class="p-3 text-[15px] font-semibold text-right text-orange-600">₹ ${formatCurrency(currentYearlyWithdrawal)}</td>
                        <td class="p-3 text-[15px] font-semibold text-right font-bold text-green-700">₹ ${formatCurrency(closing)}</td>
                    </tr>
                `;
                currentBalance = closing;
            }

            const fundInput = document.getElementById('inputFundName'); // Or your specific input ID
            const fundContainer = document.getElementById('fundNameContainer');

            // Array of tailwind color classes to rotate through
            const badgeColors = [
                // 'bg-rose-100 text-rose-700 border-rose-200',
                'bg-emerald-100 text-emerald-700 border-emerald-200',
                // 'bg-blue-100 text-blue-700 border-blue-200',
                // 'bg-amber-100 text-amber-700 border-amber-200',
                // 'bg-purple-100 text-purple-700 border-purple-200',
                // 'bg-indigo-100 text-indigo-700 border-indigo-200'
            ];

            function updateFundBadges() {
                const rawValue = fundInput.value;
                // Split by comma and filter out empty strings
                const funds = rawValue.split(',').map(f => f.trim()).filter(f => f !== "");

                if (funds.length === 0) {
                    fundContainer.innerHTML = '<span class="text-gray-400 italic text-sm">No funds entered</span>';
                    return;
                }

                fundContainer.innerHTML = funds.map((fund, index) => {
                    // Pick a color based on the index (loops back if more than 6 funds)
                    const colorClass = badgeColors[index % badgeColors.length];
                    
                    return `
                        <span class="px-3 py-1 rounded-full text-sm font-bold border ${colorClass} transition-all duration-200">
                            ${fund}
                        </span>
                    `;
                }).join('');
            }

            // Listen for typing
            fundInput.addEventListener('input', updateFundBadges);

            // Initialize on load
            updateFundBadges();

            // Summaries
            document.getElementById('totalIncomeLabel').innerText = `₹ ${(totalIncome / 10000000).toFixed(2)} Cr`;
            document.getElementById('summaryIncomeLabel').innerText = `₹ ${formatCurrency(totalIncome)}`;
            document.getElementById('finalValueLabel').innerText = `₹ ${formatCurrency(currentBalance)}`;
            
            // // Insight logic
            // const wealthMult = (currentBalance / investment).toFixed(1);
            // document.getElementById('insightText').innerHTML = 
            //     `This strategy generates a total payout of <strong>₹ ${formatCurrency(totalIncome)}</strong> while maintaining a terminal asset value of 
            //     <strong>₹ ${formatCurrency(currentBalance)}</strong>. This represents a <strong>${wealthMult}x</strong> capital growth in addition to regular income.`;
            
            // Insight text logic
            const delta = (returnPercent - withdrawalPercent) * 100;
            const statusText = delta > 0 ? "Growth exceeding payout" : "Capital depletion trajectory";
            // document.getElementById('insightText').innerText = `This plan maintains a ${delta.toFixed(1)}% growth buffer. ${statusText}. Total wealth creation (Income + Assets) is estimated at ₹ ${formatCurrency(totalIncome + currentBalance)}.`;
            document.getElementById('insightText').innerHTML = 
                `This plan maintains a <strong>${delta.toFixed(1)}%</strong> growth buffer. ${statusText}. 
                Total wealth creation (Income + Assets) is estimated at 
                <strong>₹ ${formatCurrency(totalIncome + currentBalance)}</strong>.`;

            updateChart(totalIncome, currentBalance);
        }

        function updateChart(income, final) {
            const ctx = document.getElementById('wealthChart').getContext('2d');
            if (wealthChart) wealthChart.destroy();

            // Helper for Indian Currency Formatting
            const formatCurrency = (value) => {
                return '₹' + new Intl.NumberFormat('en-IN', {
                    maximumFractionDigits: 0
                }).format(value);
            };

            wealthChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Income Taken', 'Maturity Wealth'],
                    datasets: [{
                        data: [income, final],
                        backgroundColor: ['#3b82f6', '#10b981'],
                        borderWidth: 2,
                        borderColor: '#ffffff',
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom', 
                            labels: { 
                                boxWidth: 12, 
                                padding: 20, 
                                font: { size: 14, weight: '600' }, 
                                usePointStyle: true 
                            } 
                        },
                        // Added Tooltip Formatting
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    let value = context.raw || 0;
                                    return ` ${label}: ${formatCurrency(value)}`;
                                }
                            }
                        }
                    },
                    cutout: '65%'
                }
            });
        }

        // Initialize
        window.onload = updateProposal;
        
        // Add event listeners for live updates
        document.querySelectorAll('.input-field').forEach(input => {
            input.addEventListener('input', updateProposal);
        });
    </script>
</body>
</html>